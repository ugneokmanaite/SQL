# SQL Intro: Structured Query Language

 - Language that communicates with databases
 - If you want to pull/edit/add data information to a database you can use the language of SQL do to that
 
## Easy scenario to visualise concept of Database
- Database = Warehouse
- Data tables =  Storage cabinets
- Data = Files
- Database is made using coding language e.g. C+ / Java
- How to access the data? 1) Build a "storefront app", 2) Hire a delivery/translator (SQL)
- If you learn to speak SQL you can get her to retrieve files for you

## 3 things to remember about SQL:
1. Knowing how to get data means you can use data in your job
2. There's variations (syntaxes) to SQL
3. SQL is a language that only speaks to Relational Databases 

## For table to be displayed 
```oracle-sql

SELECT * FROM EMPLOYEES

--Select the line & press run or fn + F5--

SP_HELP EMPLOYEES 

/* This shows details about the structure of table* /

```

## _What is a database?_
- Organised collection of data (repository)
- To efficiently retrieve data
- Excel is not for historically storing data- it is not organised or efficient

- Identities are formed using tables - relational (RDBMS) database 
e.g. in internet everything imputed is stored somewhere 

- Need to store table in organised manner in order to be able to query the information & retrieve it
- Need to make sure data is labelled correctly!
- Generally try to retrieve rows for full 

`USE master` to directly connect to other databases in query 

## **Terminology**
------
- **Column** : Tables are composed of columns corresponding  to attributes of object
- **Row** : One set of attributes corresponding to one instance that a table describes. Also known as Records or Tuples. 
- **Table** : predefined format of rows and columns that define an entity. Also known as file
- **DBMS** : A DataBase Management System allows computer to perform database functions of storing, retrieving, adding, deleting & modifying data. 

- Anything which we want to model (table) is an **entity**

**_Relational Databases contain connected data! The tables should be related_** 

## Primary vs Foreign Key


- _Primary key_ will uniquely identify data which can be retrieved from a database. Has to be unique and have no duplicate values. Can be different forms of data types. **SHOULDN'T CHANGE**

- _Foreign key_ can have duplicate values or have null values. It is used to link two tables together. Foreign Key is a field (or collection of fields) in one table that refers to the PRIMARY KEY in another table.

## **Types of Databases**
1. Flat-file = Stores everything in one table. Good for small numbers of records for single topic
2. Relational = Gives you ability to separate masses of data into numerous tables. Linked to each other through the use of keys
3. Big Data = MongoDB, Vertigo etc. Used for Data Analytics and Business Intelligence. Digital age and Internet of Things

# Relational Databases

- Entity relationship diagrams = shows the relationship between 2 entities

#Relationship Types

## One to One
- When one record from one table will point to only one record in a second table
- Each row in table A is linked with only 1 in table B
- e.g. Contact info table

## One to Many
- Each row in table is related to many rows in relating table
- This allows frequently used info to be saved only once in a table and referenced many times in all other tables
- For an example: An amazon order can refer to a variety of different items

## Many to Many
- One or more rows in a table to be related to 0, 1 or many rows in another table
- Third table called mapping or link is required in order to implement such relationship. 
- For an example: courses may have multiple students and a student may be enrolled in multiple courses
- **JUNCTION TABLE**  will need to be created in order to create 1-1 relationship between Table A and Table B
- **COMPOSITE PRIMARY KEY** = 2 or more columns from different tables added together to create a unique primary key. Should consider the least number of columns to create a composite primary key. E.g. *Customer ID and Order ID* PRIMARY KEY (CustomerID, OrderID)``
- **Candidate Keys** = When you can choose multiple options for primary key. The designer will choose one. 

## Primary Key
- Uniquely identifies each record in the table
- Most tables should have one
- Each table can have more than one column which is part of Primary Key (composite key) e.g. Order No + Order Line No
- It can either be an attribute that is guaranteed to be unique e.g. National insurance number or number generated by the DBMS
- The DBMS will enforce uniqueness of the Primary Key- not allowing repeated records

Two types of Primary Key
1. Simple
2. Compound / Composite Key

Primary Key Constraints
- Must be unique
- Must always have an entry (cannot be blank or Null)
- The value must never change
- Each table may have a maximum of one Primary Key

## Foreign Key 
- Used to create solid relationships
- Ensure that row of information in Table A corresponds to the correct row of Table B
- The constraint is used to prevent actions that would destroy links between tables
- It prevents valid data from being inserted into the foreign key column, because it has to be one of the values contained in the table it points to
- There is no Uniqueness Constraint for Foreign Keys
- A table can have any number of Foreign Keys
- A row cannot be deleted from a reference table if it's in use via a foreign key

# Structured Query Language
##DML- Data Manipulation Language: 
Use, Select, Insert, Update, Delete (only in DML language)- Manipulating data , (DELETE HAS A WHERE CONDITION, OTHERWISE DELETE = TRUNCATE)

## DDL- Data Definition Language: 
Create, Alter, Drop (drops table as whole or database), Truncate (lose all data and end up with empty table)

## DCL - Data Control Language:
Grant, Revoke (Rights of the user: granting some rights to testers - data admin can choose which & revoke these when required when project is over) DATA is highly secured

##TCL- - Transaction Control Language:
Commit, Rollback, Savepoint (very important that after updating, inserting you commit the change. Rollback up to a certain point and undo the changes. Savepoint is saving to the point before commiting the change that everyone can see )

## Creating a Database

```oracle-sql

CREATE DATABASE ugne_db;
/* Now create a new query and at the top add */

USE ugne_db

CREATE TABLE film_table (
film_name VARCHAR(10),
film_type VARCHAR(6), 

SELECT * FROM film_table;
)

```
## Rules

- Use capitals for your commands ( don't have to but makes reading easier when doing large queries)
- Do not use space or apostrophes in database or table names, if you do you will need [ ] brackets
- Semicolon ends every statement, only needed if more than one are being executed
- Parenthesis () open and close the list of columns that are being created 


```oracle-sql

USE ugne_db

DROP TABLE film_table

/*The Parentheses open and close the list of columns that are to be created*/

CREATE TABLE film_table
(
    film_name VARCHAR(10),
    film_type VARCHAR(6),
    date_of_release DATETIME,
    director VARCHAR (30),
    writer VARCHAR (30),
    star INT,
    film_language VARCHAR (20),
    official_website VARCHAR (30),
    plot_summary VARCHAR (1000)
)

/*ALTER can be used to RENAME, MODIFY, ADD or DROP columns*/
/*Can also be used to change to NOT NULL (ensure data has no NULL entries)*/

ALTER TABLE film_table
ALTER COLUMN film_name VARCHAR(10) NOT NULL

--restricting so no value can be left Null--

ALTER TABLE film_table
ADD release_date DATETIME;

--inserting data into table--

INSERT INTO film_table
( 
    film_name, film_type, date_of_release, director, writer, star, film_language, official_website, plot_summary
)
VALUES 
(
    'SQL', 'Drama', '2020-06-23', 'Ugne Okmanaite', 'Whatever', 4, 'English', 'www.ugne.com', 'Quick summary'
);


SELECT * from film_table

ALTER TABLE film_table
ADD film_id INT IDENTITY (1,7) PRIMARY KEY

CREATE TABLE director
(
    director_id INT IDENTITY (1,5),
    director_name VARCHAR(50),
    city VARCHAR (20) DEFAULT 'LONDON',
    film_id INT,
    PRIMARY KEY(director_id,directorNumber),
    FOREIGN KEY(film_id) REFERENCES film_table(film_id)
)

/*Here you see composite primary key & foreign key relationship being established*/

SELECT * FROM director

INSERT INTO director
(director_name, film_id)
VALUES
('Steve', 1)

SELECT * FROM director

INSERT INTO director
(director_name, film_id)
VALUES
('BOB', 4)

SELECT * FROM director
SELECT * FROM film_table

DELETE FROM film_table WHERE film_id=1

UPDATE director SET director_name='Jamie'WHERE film_id = 1

SELECT * FROM director
SELECT * FROM film_table
```

## _Deleting data_

`UPDATE director SET director_name='Jamie'WHERE film_id = 1`

## _Updating data_


ALTER = can be used to RENAME, MODIFY, ADD or DROP columns e.g. 

`ALTER TABLE film_table`

`ADD release_date DATETIME;`

This can also be used to change to NOT NULL

`ALTER TABLE film_table`

`ALTER COLUMN film_name VARCHAR(10) NOT NULL;`

`film_type VARCHAR (6) NOT NULL`

`film_cost DEC (3,2) NOT NULL DEFAULT 0);`

/*If we do not designate a NULL value it will automatically be 0*/

*** NULL is not an empty string- it's undefined value in itself!
- A value can be NULL but NULL never equals NULL because NULL is an undefined value 

To make a composite key just add a comma e.g.

`PRIMARY KEY(director_id, director_number)

## Insert Breakdown
- Column names are separated by commas
- VALUES signals the data to be inserted
- Single quotes are used for text or dates

## VARIATIONS ON INSERT
- Changing the order of columns: If you already created a table the order which you add data doesnt have to be the same as original column as long as the values match the order you are inserting
- Omitting column names: You don't have to put the column names in, but values have to be in the same order as original columns
- Leaving some columns out: You can leave some info out. For this you will have to specify the column names the values are going into

**VARCHAR, CHAR & DATE all use quotes for their values!!!**
- An insert statement including decimal & INT does not

Defining NULL

```

CREATE TABLE film_table(`

`film_name VARCHAR (10) NOT NULL,`

`film_type VARCHAR (6) NOT NULL,`

`film_cost DEC (3,2) NOT NULL DEFAULT 0);`

```

- If we do not designate a value for film_cost it will automatically be set to 0

## Deleting Data
- Be careful when choosing WHERE e.g. `film_id=1` as if it's already used as foreign key in another table it will not allow
- This is a data **integrity** issue!

## Database Considerations
1. Data Security
2. Data Recovery
3. Data Integrity
4. Normal Form




## UPDATE & DELETE 
--------
```oracle-sql

UPDATE people
       SET person_id=1
       WHERE person_id=2

/*If you need to change the contents of the table
WHERE clause is require to make sure the whole table is not updated!!!*/
```

```oracle-sql
DELETE FROM people
       WHERE person id=2

/*Remove row from table then use DELETE statement. 
If WHERE clause is not used the whole table will be deleted*/
```
- Need to make sure whatever is being deleted is not already used as a foreign/primary key as this is a DATA INTEGRITY ISSUE
- To avoid this **DELETE CASCADE**  can be used.

## CONTRAINTS
- Used to specify rules for data in table 
- E.g. **NOT NULL, DEFAULT, UNIQUE, PRIMARY KEY, FOREIGN KEY, CHECK, INDEX** 

## DELETE CASCADE
- A foreign key with delete cascade means if record in parent table is deleted then the corresponding records in child table will automatically be deleted
- Can be created using CREATE TABLE or ALTER TABLE
- More info: https://www.techonthenet.com/sql_server/foreign_keys/foreign_delete.php#:~:text=A%20foreign%20key%20with%20cascade%20delete%20means%20that%20if%20a,cascade%20delete%20in%20SQL%20Server.

```oracle-sql
ALTER TABLE director
ADD CONSTRAINT foreign_key_onFilmId FOREIGN KEY (film_id)
REFERENCES film_table (film_id) ON DELETE CASCADE;
```